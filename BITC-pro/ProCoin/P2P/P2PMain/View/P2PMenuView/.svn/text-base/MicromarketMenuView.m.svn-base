//
//  MicromarketMenuView.m
//  TJRtaojinroad
//
//  Created by taojinroad on 3/29/16.
//  Copyright © 2016 淘金路. All rights reserved.
//

#import "MicromarketMenuView.h"
#import "LewPopupViewAnimationSpring.h"
#import "TJRBaseViewController.h"
#import "UIButton+NewNum.h"

@interface MicromarketMenuView () <UIGestureRecognizerDelegate> {
    TJRBaseViewController* ctr;
}

@property (retain, nonatomic) IBOutlet UIView *bgView;
@property (retain, nonatomic) IBOutlet UIView *menuView;
@property (retain, nonatomic) IBOutlet UIView *baseView;

@property (retain, nonatomic) IBOutlet UIButton *btnPersonNew;
@end

@implementation MicromarketMenuView

- (id)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    
    if (self) {
        [self initTradeMenuView];
    }
    
    return self;
}

- (id)initWithCoder:(NSCoder *)aDecoder {
    self = [super initWithCoder:aDecoder];
    
    if (self) {
        [self initTradeMenuView];
    }
    
    return self;
}

- (void)initTradeMenuView{
    
    self.frame = CGRectMake(0, 0, phoneRectScreen.size.width, phoneRectScreen.size.height);
    
    [[NSBundle mainBundle] loadNibNamed:@"MicromarketMenuView" owner:self options:nil];
    CGRect frame = self.baseView.frame;
    frame.origin = CGPointZero;
    frame.size = self.frame.size;
    self.baseView.frame = frame;
    [self addSubview:_baseView];
    
    _menuView.alpha = 0;
    
    CALayer *layer = [_menuView layer];
    layer.shadowOffset = CGSizeMake(0, 3);
    layer.shadowRadius = 5.0;
    layer.shadowColor = [UIColor blackColor].CGColor;
    layer.shadowOpacity = 0.8;
    
    UITapGestureRecognizer *tapGestureRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(backgroundTouched:)];
    [tapGestureRecognizer setDelegate:self];
    [_bgView addGestureRecognizer:tapGestureRecognizer];
    [tapGestureRecognizer release];
}

- (void)backgroundTouched:(UIGestureRecognizer*) recognizer{
    [self hide];
}

- (void)show:(UIView*)superView
{
    [superView addSubview:self];
    _bgView.alpha = 0;
    
    [UIView animateWithDuration:0.2
                     animations:^{
                         _menuView.alpha = 1;
                         _bgView.alpha = 0.2;
                     } completion:^(BOOL finished) {
                         
                     }];
}

- (void)hide
{
    [UIView animateWithDuration:0.2
                     animations:^{
                         _menuView.alpha = 0;
                         _bgView.alpha = 0;
                     } completion:^(BOOL finished) {
                         [self removeFromSuperview];
                     }];
}

- (void)setPersonNewCount:(NSInteger)count{
    [_btnPersonNew showNewNum:MIN(99, count)];
}


- (IBAction)shareButtonClicked:(id)sender {
    [self hide];
    if (_delegate && [_delegate respondsToSelector:@selector(micromarketMenuView:shareButtonClicked:)]) {
        [_delegate micromarketMenuView:self shareButtonClicked:sender];
    }
}

- (IBAction)replaceButtonClicked:(id)sender {
    [self hide];
    if (_delegate && [_delegate respondsToSelector:@selector(micromarketMenuView:replaceButtonClicked:)]) {
        [_delegate micromarketMenuView:self replaceButtonClicked:sender];
    }
}

- (IBAction)personButtonClicked:(id)sender {
    [self hide];
    if (_delegate && [_delegate respondsToSelector:@selector(micromarketMenuView:personButtonClicked:)]) {
        [_delegate micromarketMenuView:self personButtonClicked:sender];
    }
}

- (IBAction)orderButtonClicked:(id)sender {
    [self hide];
    if (_delegate && [_delegate respondsToSelector:@selector(micromarketMenuView:orderButtonClicked:)]) {
        [_delegate micromarketMenuView:self orderButtonClicked:sender];
    }
}

- (void)dealloc{
    [_bgView release];
    [_menuView release];
    [_baseView release];

    [_btnPersonNew release];
    [super dealloc];
}

@end
